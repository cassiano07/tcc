CREATE DATABASE EA;

CREATE DATABASE EA;

use ea;

CREATE TABLE usuarios(
        id int(5) AUTO_INCREMENT,
        nome_completo varchar(100) NOT NULL,
        email varchar(100) NOT NULL,
        telefone int(14) NOT NULL,
        senha varchar(100) NOT NULL,
        categoria_id int(3) NOT NULL,
        data_criacao DATETIME DEFAULT CURRENT_TIMESTAMP,
        data_atualizacao DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (id)
);

CREATE TABLE conteudo_arquivo(
        id int(3) AUTO_INCREMENT,
        titulo varchar(100) NOT NULL,
        dados longtext NOT NULL,
        usuario_id int(5) NOT NULL,
        data_criacao DATETIME DEFAULT CURRENT_TIMESTAMP,
        data_atualizacao DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (id)
);
    

CREATE TABLE favorito(
        id int(3) AUTO_INCREMENT,
        conteudo_id int(3) NOT NULL,
        dimensao varchar(100) NOT NULL,
        metrica varchar(100) NOT NULL,
        operacao varchar(100) NOT NULL,
        grafico_id int(3) NOT NULL,
        usuario_id int(5) NOT NULL,
        data_criacao DATETIME DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (id)
);
   
CREATE TABLE historico(
        id int(3) AUTO_INCREMENT,
        grafico_id int(3),
        conteudo_id int(3),
        evento varchar(100) NOT null,
        data_criacao DATETIME DEFAULT CURRENT_TIMESTAMP,
        usuario_id int(3),
        favorito_id int(3),
        PRIMARY KEY (id)
);
   
CREATE TABLE grafico(
        id int(3) AUTO_INCREMENT,
        nome varchar(100) NOT NULL,
        tipo varchar(100) NOT NULL,
        data_criacao DATETIME DEFAULT CURRENT_TIMESTAMP,
        PRIMARY KEY (id)
);

CREATE TABLE categoria_usuario(
        id int(3) AUTO_INCREMENT,
        nome_categoria varchar(100) NOT null,
        PRIMARY KEY (id)
);

INSERT INTO categoria_usuario(nome_categoria) VALUES ('Administradores');
INSERT INTO categoria_usuario(nome_categoria) VALUES ('Usuarios');
INSERT INTO grafico (id, nome, tipo) VALUES (1, 'Gráfico de linha', 'line'), (2, 'Gráfico de barra', 'bar'), (3, 'Gráfico de Radar', 'radar'), (4, 'Gráfico de Torta', 'pie'), (5, 'Gráfico Aréa Polar', 'polararea'), (6, 'Gráfico de Linha Simples', 'linesimple');


ALTER TABLE favorito
ADD CONSTRAINT fk_ID_usuario
FOREIGN KEY (usuario_id)
REFERENCES usuarios(id)
ON DELETE CASCADE
ON UPDATE CASCADE;

ALTER TABLE favorito 
ADD CONSTRAINT fk_ID_grafico 
FOREIGN KEY (grafico_id) 
REFERENCES grafico(id) 
ON DELETE CASCADE 
ON UPDATE CASCADE;

ALTER TABLE favorito 
ADD CONSTRAINT fk_ID_conteudo
FOREIGN KEY (conteudo_id) 
REFERENCES conteudo_arquivo(id) 
ON DELETE CASCADE 
ON UPDATE CASCADE;

ALTER TABLE conteudo_arquivo 
ADD CONSTRAINT fk_ID_usuarios 
FOREIGN KEY (usuario_id) 
REFERENCES usuarios(id) 
ON DELETE CASCADE 
ON UPDATE CASCADE;

ALTER TABLE historico
ADD CONSTRAINT fk_ID_usuariohistorico
FOREIGN KEY (usuario_id)
REFERENCES usuarios(id)
ON DELETE CASCADE
ON UPDATE CASCADE;

ALTER TABLE historico 
ADD CONSTRAINT fk_ID_graficohistorico 
FOREIGN KEY (grafico_id) 
REFERENCES grafico(id) 
ON DELETE CASCADE 
ON UPDATE CASCADE;

ALTER TABLE historico 
ADD CONSTRAINT fk_ID_conteudohistorico
FOREIGN KEY (conteudo_id) 
REFERENCES conteudo_arquivo(id) 
ON DELETE CASCADE 
ON UPDATE CASCADE;

ALTER TABLE historico 
ADD CONSTRAINT fk_ID_favoritohistorico
FOREIGN KEY (favorito_id) 
REFERENCES favorito(id) 
ON DELETE CASCADE 
ON UPDATE CASCADE;

ALTER TABLE usuarios 
ADD CONSTRAINT fk_ID_usuariocategoria
FOREIGN KEY (categoria_id) 
REFERENCES categoria_usuario(id) 
ON DELETE CASCADE 
ON UPDATE CASCADE;